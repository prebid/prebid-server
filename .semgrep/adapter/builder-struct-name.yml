rules:
  - id: builder-struct-name-check
    languages:
      - go
    message: >
      Using the adapter name for the struct makes it redundant with the package name. 
      In following example, since the struct name is the same as the package name (`Foo` and `foo` respectively). Importing it results in a redundant package reference: `foo.Foo`. 
      
      ```
        package foo

        type Foo struct{
         endpoint string
        }
      ```

      To avoid this redundancy and for better clarity, it is recommended to rename `$BUILDER` to `adapter`.

      ```
        package foo

        type adapter struct {
          endpoint string
        }
        func  Builder(bidderName openrtb_ext.BidderName, config config.Adapter, server config.Server) (adapters.Bidder, error) {
          return &adapter{endpoint: "https://www.foo.com"}, nil
        }
      ```
    severity: WARNING
    patterns:
      - pattern-either:
          - pattern-inside: >
              func Builder($BIDDER_NAME openrtb_ext.BidderName, $CONFIG config.Adapter, $SERVER config.Server) (adapters.Bidder, error) {
                ...
                $BUILDER_OBJ := &$BUILDER{...}
                ...
                return $BUILDER_OBJ, nil
              }
          - pattern-inside: >
              func Builder($BIDDER_NAME openrtb_ext.BidderName, $CONFIG config.Adapter, $SERVER config.Server) (adapters.Bidder, error) {
                ...
                $BUILDER_OBJ := $BUILDER{...}
                ...
                return &$BUILDER_OBJ, nil
              }
          - pattern-inside: >
              func Builder($BIDDER_NAME openrtb_ext.BidderName, $CONFIG config.Adapter, $SERVER config.Server) (adapters.Bidder, error) {
                ...
                return &$BUILDER{...}, ...
              }
          - pattern-inside: >
              func Builder($BIDDER_NAME openrtb_ext.BidderName, $CONFIG config.Adapter, $SERVER config.Server) (adapters.Bidder, error) {
                ...
                var $BUILDER_OBJ $BUILDER
                ...
                return &$BUILDER_OBJ, ...
              }            
          - pattern-inside: >
              func Builder($BIDDER_NAME openrtb_ext.BidderName, $CONFIG config.Adapter, $SERVER config.Server) (adapters.Bidder, error) {
                ...
                var $BUILDER_OBJ *$BUILDER
                ...
                return $BUILDER_OBJ, ...
              }        
      - focus-metavariable: $BUILDER
      - metavariable-regex:
          metavariable: $BUILDER
          regex: (?!adapter$)
